<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>סימולטור מימון - קרדיבל</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Heebo', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        html, body {
            font-family: 'Heebo', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        #app {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        input::placeholder {
            color: #94a3b8;
            opacity: 0.6;
        }
        input {
            font-size: 17px !important;
        }
        @supports (height: 100dvh) {
            #app {
                height: 100dvh;
            }
        }
    </style>
</head>
<body class="bg-[#1e293b] text-white">
    <div id="app" class="flex flex-col" style="padding-top: env(safe-area-inset-top);">
        
        <!-- Logo -->
        <div class="w-full flex justify-center pt-4 pb-2 shrink-0">
            <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 301.68 65.71" class="h-8 w-auto">
                <defs>
                    <linearGradient id="linear-gradient" x1="209.98" y1="58.62" x2="301.68" y2="58.62" gradientUnits="userSpaceOnUse">
                        <stop offset="0" stop-color="#f6d19c"/><stop offset=".36" stop-color="#d4a55f"/><stop offset=".69" stop-color="#c89644"/><stop offset="1" stop-color="#9c7229"/>
                    </linearGradient>
                    <linearGradient id="linear-gradient-2" x1="0" y1="58.62" x2="91.7" y2="58.62" gradientUnits="userSpaceOnUse">
                        <stop offset="0" stop-color="#9c7229"/><stop offset=".31" stop-color="#c89644"/><stop offset=".64" stop-color="#d4a55f"/><stop offset="1" stop-color="#f6d19c"/>
                    </linearGradient>
                    <linearGradient id="linear-gradient-3" x1="205.46" y1="34.15" x2="234.12" y2="5.49" xlink:href="#linear-gradient-2"/>
                    <linearGradient id="linear-gradient-4" x1="231.49" y1="36.91" x2="256.16" y2="12.23" xlink:href="#linear-gradient-2"/>
                    <linearGradient id="linear-gradient-5" x1="253.6" y1="33.89" x2="282.52" y2="4.96" xlink:href="#linear-gradient-2"/>
                    <linearGradient id="linear-gradient-6" x1="278.37" y1="35.09" x2="304.84" y2="8.61" xlink:href="#linear-gradient-2"/>
                    <linearGradient id="linear-gradient-7" x1="2.17" y1="41.24" x2="41.51" y2="1.89" xlink:href="#linear-gradient-2"/>
                </defs>
                <g id="Layer_1-2" data-name="Layer 1"><g><rect fill="url(#linear-gradient)" x="209.98" y="58.3" width="91.7" height=".64"/><rect fill="url(#linear-gradient-2)" y="58.3" width="91.7" height=".64"/><g><path fill="#ffffff" d="m59.83.12c-6.52,0-9.2,4.63-9.2,10.78v21.81c0,6.15,2.68,10.78,9.2,10.78s9.2-4.63,9.2-10.78v-4.87h-2.68v5.06c0,4.57-1.77,7.98-6.46,7.98s-6.46-3.41-6.46-7.98V10.72c0-4.57,1.77-8.04,6.46-8.04s6.46,3.47,6.46,8.04v3.72h2.68v-3.53c0-6.15-2.68-10.78-9.2-10.78Z"/><path fill="#ffffff" d="m91.63,31.38c0-4.63-1.77-7.74-6.15-8.71,4.2-.97,6.15-3.84,6.15-8.83v-3.72c0-6.03-2.62-9.63-9.14-9.63h-8.89v42.65h2.8v-19.07h4.45c4.87,0,7.98,1.58,7.98,7.25v6.7c0,2.32.18,3.84.91,5.12h2.92c-.91-1.4-1.03-3.35-1.03-5.12v-6.64Zm-15.23-9.87V3.05h6.03c4.63,0,6.4,2.74,6.4,7.31v4.02c0,5.73-2.92,7.13-7.92,7.13h-4.51Z"/><polygon fill="#ffffff" points="97.11 43.13 113.93 43.13 113.93 40.58 99.91 40.58 99.91 22.79 111.55 22.79 111.55 20.23 99.91 20.23 99.91 3.05 113.93 3.05 113.93 .49 97.11 .49 97.11 43.13"/><path fill="#ffffff" d="m127.88.49h-9.38v42.65h9.38c6.58,0,9.44-4.33,9.44-10.6V11.09c0-6.28-2.86-10.6-9.44-10.6Zm6.64,32.17c0,4.69-1.95,7.92-6.7,7.92h-6.52V3.05h6.52c4.69,0,6.7,3.23,6.7,7.92v21.69Z"/><rect fill="#ffffff" x="141.95" y=".49" width="2.8" height="42.65"/><path fill="#ffffff" d="m161.69,20.41c4.33-.91,5.61-3.78,5.61-8.41v-2.44c0-5.91-2.32-9.08-8.71-9.08h-8.96v42.65h9.14c6.52,0,9.32-3.72,9.32-9.87v-3.72c0-4.81-1.77-8.22-6.4-9.14Zm-9.26-17.36h6.09c4.57,0,5.97,2.32,5.97,6.76v2.74c0,5.42-2.32,6.76-7.31,6.76h-4.75V3.05Zm12.85,30.16c0,4.75-1.83,7.37-6.52,7.37h-6.34v-18.7h5.3c5.06,0,7.55,1.95,7.55,7.49v3.84Z"/><polygon fill="#ffffff" points="175.46 .49 172.65 .49 172.65 43.13 188.86 43.13 188.86 40.58 175.46 40.58 175.46 .49"/><polygon fill="#ffffff" points="209.88 3.05 209.88 .49 193.06 .49 193.06 43.13 209.88 43.13 209.88 40.58 195.87 40.58 195.87 22.79 207.5 22.79 207.5 20.23 195.87 20.23 195.87 3.05 209.88 3.05"/></g><g><path fill="url(#linear-gradient-3)" d="m224.32.49h-9.87v42.65h6.7v-16.02h3.17c6.7,0,9.99-3.72,9.99-10.54v-5.54c0-6.82-3.29-10.54-9.99-10.54Zm3.29,16.51c0,3.05-1.16,4.02-3.29,4.02h-3.17V6.58h3.17c2.13,0,3.29.97,3.29,4.02v6.4Z"/><polygon fill="url(#linear-gradient-4)" points="244.42 .49 237.72 .49 237.72 43.13 255.45 43.13 255.45 37.04 244.42 37.04 244.42 .49"/><path fill="url(#linear-gradient-5)" d="m271.71,33.39c0,3.05-1.34,4.14-3.47,4.14s-3.47-1.1-3.47-4.14V.49h-6.7v32.47c0,6.82,3.41,10.72,9.99,10.72s9.99-3.9,9.99-10.72V.49h-6.34v32.9Z"/><path fill="url(#linear-gradient-6)" d="m288.47,10.3c0-3.05,1.22-4.2,3.35-4.2s3.35,1.16,3.35,4.2v1.77h6.34v-1.34c0-6.82-3.35-10.72-9.87-10.72s-9.87,3.9-9.87,10.72c0,12.18,13.1,13.83,13.1,22.6,0,3.05-1.34,4.14-3.47,4.14s-3.47-1.1-3.47-4.14v-3.05h-6.34v2.62c0,6.82,3.41,10.72,9.99,10.72s9.99-3.9,9.99-10.72c0-12.18-13.1-13.83-13.1-22.6Z"/></g><path fill="url(#linear-gradient-7)" d="m32.51,38.57h-4c-.99,0-1.79-.8-1.79-1.79v-1.55c-.03-.21-.06-.42-.06-.63v-9.22h-9.22c-.14,0-.28,0-.42-.02h-1.62c-.99,0-1.79-.8-1.79-1.79v-4c0-.99.8-1.79,1.79-1.79h11.26v-9.21c0-.22.02-.42.06-.63v-1.38c0-.99.8-1.79,1.79-1.79h4c.99,0,1.79.8,1.79,1.79v11.22h9.1V6.47c0-3.57-2.9-6.47-6.47-6.47H6.74C3.17,0,.27,2.9.27,6.47v30.2c0,3.57,2.9,6.47,6.47,6.47h30.2c3.57,0,6.47-2.9,6.47-6.47v-11.28h-9.1v11.4c0,.99-.8,1.79-1.79,1.79Z"/></g></g>
            </svg>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col px-5 pt-4 overflow-y-auto pb-4" style="overflow-y: auto; -webkit-overflow-scrolling: touch;">
            <div class="flex flex-col gap-3 w-full max-w-md mx-auto">

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-[#2d3a4d] rounded-2xl px-4 py-4 min-h-[62px] flex items-center">
                        <input type="text" inputmode="numeric" id="loanAmount" class="w-full bg-transparent outline-none text-[17px] text-white text-center placeholder-slate-400" placeholder="סכום המימון"/>
                    </div>
                    <div class="bg-[#2d3a4d] rounded-2xl px-4 py-4 min-h-[62px] flex items-center">
                        <input type="text" inputmode="numeric" id="balloonAmount" class="w-full bg-transparent outline-none text-[17px] text-white text-center placeholder-slate-400" placeholder="סכום הבלון"/>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-[#2d3a4d] rounded-2xl px-4 py-4 min-h-[62px] flex items-center">
                        <input type="number" inputmode="numeric" id="months" value="60" class="w-full bg-transparent outline-none text-[17px] text-white text-center"/>
                    </div>
                    <div id="trackToggle" class="bg-[#2d3a4d] rounded-2xl px-4 py-4 min-h-[62px] flex items-center justify-center cursor-pointer active:bg-[#354254] transition-colors relative">
                        <span id="trackLabel" class="text-[17px] text-white text-center">צמוד פריים</span>
                        <div class="absolute left-4 flex flex-col gap-[3px]">
                            <div class="w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-b-[6px] border-b-gray-400"></div>
                            <div class="w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[6px] border-t-gray-400"></div>
                        </div>
                    </div>
                </div>

                <div id="primeRates" class="grid grid-cols-2 gap-3">
                    <div class="bg-[#2d3a4d] rounded-2xl px-4 py-4 min-h-[62px] flex items-center">
                        <input type="number" step="0.1" inputmode="decimal" id="primeRate" value="5.5" class="w-full bg-transparent outline-none text-[17px] text-white text-center"/>
                    </div>
                    <div class="bg-[#2d3a4d] rounded-2xl px-4 py-4 min-h-[62px] flex items-center">
                        <input type="number" step="0.1" inputmode="decimal" id="margin" value="1.7" class="w-full bg-transparent outline-none text-[17px] text-white text-center"/>
                    </div>
                </div>

                <div id="indexRate" class="bg-[#2d3a4d] rounded-2xl px-4 py-4 min-h-[62px] flex items-center" style="display: none;">
                    <input type="number" step="0.1" inputmode="decimal" id="indexInterest" value="4.4" class="w-full bg-transparent outline-none text-[17px] text-white text-center"/>
                </div>

                <div class="bg-[#2d3a4d] rounded-2xl p-4 shadow-lg mt-1 relative">
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[1px] h-20 bg-slate-600/40"></div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-[11px] text-slate-400 uppercase tracking-wide font-light mb-1.5">החזר חודשי משוער</div>
                            <div id="monthlyPayment" class="text-3xl font-semibold text-[#c9a25a] leading-tight">₪0</div>
                        </div>
                        <div class="text-center">
                            <div class="text-[11px] text-slate-400 uppercase tracking-wide font-light mb-1.5">ריבית משוקללת</div>
                            <div id="effectiveRate" class="text-3xl font-light text-white leading-tight" dir="ltr">0.00%</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 pt-3 border-t border-slate-600/30">
                        <div class="text-center">
                            <div class="text-[10px] text-slate-500 uppercase tracking-wide mb-1 font-light">סה"כ לתשלום</div>
                            <div id="totalPayment" class="text-sm font-light text-slate-300">₪0</div>
                        </div>
                        <div class="text-center">
                            <div class="text-[10px] text-slate-500 uppercase tracking-wide mb-1 font-light">סה"כ ריבית</div>
                            <div id="totalInterest" class="text-sm font-light text-slate-300">₪0</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <footer class="pb-5 px-4 shrink-0 text-center" style="padding-bottom: calc(1.25rem + env(safe-area-inset-bottom));">
            <div class="flex flex-col gap-1">
                <p class="text-[10px] font-light text-[#c9a25a] opacity-70">כל הזכויות שמורות לקרדיבל פלוס בע״מ</p>
                <p class="text-[9px] font-light text-[#c9a25a] tracking-wider opacity-50">ט.ל.ח</p>
            </div>
        </footer>

    </div>

    <script>
        let track='prime';
        const inputFields = ['loanAmount', 'balloonAmount', 'months', 'primeRate', 'margin'];
        
        function preventViewportResize() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('focus', () => {
                    setTimeout(() => {
                        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            });
        }
        
        function loadSavedValues(){
            const a=localStorage.getItem('primeRate'),b=localStorage.getItem('margin');
            null!==a&&(document.getElementById('primeRate').value=a),null!==b&&(document.getElementById('margin').value=b)
        }
        
        function formatNumber(a){
            if(null===a||void 0===a||''===a)return'';
            const b=a.toString().split('.');
            return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,','),b.join('.')
        }
        
        function parseNumber(a){
            return'string'!=typeof a?a:a.replace(/,/g,'')
        }
        
        function calculate(){
            const a=parseFloat(parseNumber(document.getElementById('loanAmount').value)||0),
                  b=parseFloat(parseNumber(document.getElementById('balloonAmount').value)||0),
                  c=parseInt(document.getElementById('months').value||0);
            let d;
            d='prime'===track?parseFloat(document.getElementById('primeRate').value||0)+parseFloat(document.getElementById('margin').value||0):parseFloat(document.getElementById('indexInterest').value||0);
            const e=d/100/12;
            if(0>=a||0>=c)return document.getElementById('monthlyPayment').textContent='\u20AA0',document.getElementById('totalPayment').textContent='\u20AA0',document.getElementById('totalInterest').textContent='\u20AA0',void(document.getElementById('effectiveRate').textContent='0.00%');
            let f,g;
            if(0===e){
                const d=a-b;
                f=d/c,g=f*c+b
            }else{
                const d=e,h=c,i=a,j=b,k=j/Math.pow(1+d,h),l=i-k;
                f=l*(d*Math.pow(1+d,h))/(Math.pow(1+d,h)-1),g=f*c+b
            }
            const h=g-a;
            document.getElementById('monthlyPayment').textContent='\u20AA'+formatNumber(Math.round(f)),
            document.getElementById('totalPayment').textContent='\u20AA'+formatNumber(Math.round(g)),
            document.getElementById('totalInterest').textContent='\u20AA'+formatNumber(Math.round(h)),
            document.getElementById('effectiveRate').textContent=d.toFixed(2)+'%'
        }
        
        inputFields.forEach((fieldId, index) => {
            const input = document.getElementById(fieldId);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const nextIndex = index + 1;
                    if (nextIndex < inputFields.length) {
                        const nextField = track === 'prime' && nextIndex === 3 ? 'primeRate' : 
                                         track === 'index' && nextIndex === 3 ? 'indexInterest' : 
                                         inputFields[nextIndex];
                        document.getElementById(nextField).focus();
                    } else {
                        input.blur();
                    }
                }
            });
        });
        
        document.getElementById('trackToggle').addEventListener('click',function(){
            track='prime'===track?'index':'prime',
            'prime'===track?(document.getElementById('trackLabel').textContent='\u05E6\u05DE\u05D5\u05D3 \u05E4\u05E8\u05D9\u05D9\u05DD',document.getElementById('primeRates').style.display='grid',document.getElementById('indexRate').style.display='none'):(document.getElementById('trackLabel').textContent='\u05E6\u05DE\u05D5\u05D3 \u05DE\u05D3\u05D3',document.getElementById('primeRates').style.display='none',document.getElementById('indexRate').style.display='block'),
            calculate()
        });
        
        function setupFormattedInput(a){
            const b=document.getElementById(a);
            b.addEventListener('input',function(a){
                const c=a.target.selectionStart,d=a.target.value,e=d.length,f=parseNumber(d),g=formatNumber(f);
                a.target.value=g;
                const h=g.length,i=h-e;
                a.target.setSelectionRange(c+i,c+i),calculate()
            })
        }
        
        function setupLocalStorage(a,b){
            const c=document.getElementById(a);
            c.addEventListener('change',function(){localStorage.setItem(b,this.value)})
        }
        
        setupFormattedInput('loanAmount'),setupFormattedInput('balloonAmount'),setupLocalStorage('primeRate','primeRate'),setupLocalStorage('margin','margin'),
        ['loanAmount','balloonAmount','months','primeRate','margin','indexInterest'].forEach(a=>{document.getElementById(a).addEventListener('input',calculate)}),
        preventViewportResize(),
        loadSavedValues(),
        calculate();
    </script>
</body>
</html>
